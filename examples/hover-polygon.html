<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <title>CartoDB | Leaflet library with interaction</title>
    <link href="http://developers.cartodb.com/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../css/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="http://developers.cartodb.com/javascripts/all.js" type="text/javascript"></script>    
    <link rel="shortcut icon" href="http://developers.cartodb.com/images/favicon.ico" />
    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-20934186-3']); _gaq.push(['_setDomainName', 'cartodb.com']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();
    </script>
    <noscript><meta http-equiv="refresh" content="0;url=http://cartodb.com/no_javascript.html"></noscript>
  </head>
  <body class="developers examples" onload="initialize()">
    <div class="background blue grid fixed">
      <header>
        <h1 class="left">
          <a href="http://cartodb.com">CartoDB</a>
        </h1>
        <nav class="right">
          <a href="http://cartodb.com/tour">Tour</a>
          <a href="http://cartodb.com/maps">Maps</a>
          <a class="selected" href="http://developers.cartodb.com">Developers</a>
          <a href="http://cartodb.com/pricing">Pricing</a>
          <a href="http://cartodb.com/login">Sign in</a>
        </nav>
      </header>
    </div>

    <div class="background floating">
      <section class="shadow top">
        <div class="content">
          <hgroup><h2 class="dark">CartoDB Leaflet - Hover interactivity with polygons</h2><em class="hard">HARD</em></hgroup>
        </div>
        <div class="content no_padding border code">

          <link rel="stylesheet" href="http://code.leafletjs.com/leaflet-0.3.1/leaflet.css" />
          <!--[if lt IE 9]> <link rel="stylesheet" href="http://code.leafletjs.com/leaflet-0.3.1/leaflet.ie.css" /> <![endif]-->
          <link  href="../css/cartodb-leaflet.css" rel="stylesheet" type="text/css">
          <script src="http://code.leafletjs.com/leaflet-0.3.1/leaflet.js"></script>
          <script type="text/javascript" src="../js/wax.leaf.min-6.0.5-touched.js"></script>
          <script type="text/javascript" src="../dist/cartodb-leaflet-min.js"></script>
          <script type="text/javascript" src="../dist/cartodb-popup-min.js"></script>

          <script type="text/javascript">
            function initialize() {
              var map = new L.Map('map').setView(new L.LatLng(40.718379593199494, -73.99772644042969), 14)
                , mapboxUrl = 'http://{s}.tiles.mapbox.com/v3/cartodb.map-1nh578vv/{z}/{x}/{y}.png'
                , mapbox = new L.TileLayer(mapboxUrl, {maxZoom: 18, attribution: "Powered by Leaflet and Mapbox"});
              map.addLayer(mapbox,true);

              // Create a CartoDB leaflet popup
              var popup = new L.CartoDBPopup()
                // Initialize hover polygon
                , polygon = new L.GeoJSON(null)
                // Hover polygon style
                , polygon_style = {color: "#333", weight: 2, opacity:1, fillOpacity: 0, clickable:false}
                // Second cartodb layer, earthquakes
                , nyc_parks = new L.CartoDBLayer({
                    map: map,
                    user_name:"examples",
                    table_name: 'nyc_parks',
                    query: "SELECT cartodb_id,location,acres,ST_SIMPLIFY(the_geom_webmercator,0.0001) as the_geom_webmercator,ST_ASGEOJSON(ST_SIMPLIFY(the_geom,0.0001)) as geometry FROM {{table_name}}",
                    opacity: 1,
                    interactivity: "cartodb_id, location, geometry, acres",
                    featureOver: function(ev,latlng,pos,data) {
                      document.body.style.cursor = "pointer";

                      // Show the hover polygon if it is a different feature
                      if (data.cartodb_id != polygon.cartodb_id) {
                        map.removeLayer(polygon);
                        polygon.off("featureparse");
                      
                        polygon = new L.GeoJSON(null);
                        polygon.cartodb_id = data.cartodb_id;
                        
                        // Change style
                        polygon.on("featureparse", function (e) {
                          e.layer.setStyle(polygon_style);
                        });

                        polygon.addGeoJSON(JSON.parse(data.geometry));
                        map.addLayer(polygon);
                      }
                    },
                    featureOut: function() {
                      document.body.style.cursor = "default";

                      // Hide and remove in any case the hover polygon
                      polygon.cartodb_id = null;
                      polygon.off("featureparse");
                      map.removeLayer(polygon)
                    },
                    featureClick: function(ev,latlng,pos,data) {
                      // Stop propagation
                      ev.stopPropagation();

                      // Set popup content
                      var html = '';
                      for(var column in data) {
                        if (column != "geometry") {
                          html += '<label>' + column + '</label>';
                          html += '<p>' + data[column] + '</p>';
                        }
                      }
                      popup.setContent(html);

                      // Set latlng
                      popup.setLatLng(latlng);

                      // Show it!
                      map.openPopup(popup);
                    },
                    auto_bound: false,
                    debug: false
                  });
                  
              // Adding the layer to map
              map.addLayer(nyc_parks);
            }
          </script>
          <div id="map"></div>
          <span class="separator"></span>
        </div>
        <a class="back" href="http://developers.cartodb.com/">Back</a>
      </section>

      <section class="shadow leftwards bottom nav">
        <div class="content overflow">
          <div class="left">
            <h3 class="big">Overview</h3>
            <p class="light margin15">This is an example using the CartoDB Leaflet library with hover interactivity. We encourage you to read Leaflet documentation about <a href="http://leaflet.cloudmade.com/examples/geojson.html" target="_blank">how to manage a GeoJSON</a>.</p>

            <h5 class="margin30">Code</h5>
            <pre class="margin10" data-language="javascript">
/*
 * Remember to load all the necessary files
 * And after that, when the document will be ready, do this:
 */

function initialize() {
  var map = new L.Map('map').setView(new L.LatLng(40.718379593199494, -73.99772644042969), 14)
    , mapboxUrl = 'http://{s}.tiles.mapbox.com/v3/cartodb.map-1nh578vv/{z}/{x}/{y}.png'
    , mapbox = new L.TileLayer(mapboxUrl, {maxZoom: 18, attribution: "Powered by Leaflet and Mapbox"});
  map.addLayer(mapbox,true);

  // Create a CartoDB leaflet popup
  var popup = new L.CartoDBPopup()
    // Initialize hover polygon
    , polygon = new L.GeoJSON(null)
    // Hover polygon style
    , polygon_style = {color: "#333", weight: 2, opacity:1, fillOpacity: 0, clickable:false}
    // Second cartodb layer, earthquakes
    , nyc_parks = new L.CartoDBLayer({
        map: map,
        user_name:"examples",
        table_name: 'nyc_parks',
        query: "SELECT cartodb_id,location,acres,ST_SIMPLIFY(the_geom_webmercator,0.0001) as the_geom_webmercator,ST_ASGEOJSON(ST_SIMPLIFY(the_geom,0.0001)) as geometry FROM {{table_name}}",
        opacity: 1,
        interactivity: "cartodb_id, location, geometry, acres",
        featureOver: function(ev,latlng,pos,data) {
          document.body.style.cursor = "pointer";

          // Show the hover polygon if it is a different feature
          if (data.cartodb_id != polygon.cartodb_id) {
            map.removeLayer(polygon);
            polygon.off("featureparse");
          
            polygon = new L.GeoJSON(null);
            polygon.cartodb_id = data.cartodb_id;
            
            // Change style
            polygon.on("featureparse", function (e) {
              e.layer.setStyle(polygon_style);
            });

            polygon.addGeoJSON(JSON.parse(data.geometry));
            map.addLayer(polygon);
          }
        },
        featureOut: function() {
          document.body.style.cursor = "default";

          // Hide and remove in any case the hover polygon
          polygon.cartodb_id = null;
          polygon.off("featureparse");
          map.removeLayer(polygon)
        },
        featureClick: function(ev,latlng,pos,data) {
          // Stop propagation
          ev.stopPropagation();

          // Set popup content
          var html = '';
          for(var column in data) {
            if (column != "geometry") {
              html += '<label>' + column + '</label>';
              html += '<p>' + data[column] + '</p>';
            }
          }
          popup.setContent(html);

          // Set latlng
          popup.setLatLng(latlng);

          // Show it!
          map.openPopup(popup);
        },
        auto_bound: false,
        debug: false
      });
      
  // Adding the layer to map
  map.addLayer(nyc_parks);
}</pre>
          </div>
          <div class="right">
            <a class="button blue download" href="https://github.com/Vizzuality/cartodb-leaflet/zipball/gh-pages">Download this library</a>
            <h3 class="big margin40">Related resources</h3>
            <ul class="vt related">  
              <li><a href="http://developers.cartodb.com/documentation/cartodb-apis.html#maps_api">CartoDB Maps API</a></li>
              <li><a href="http://vizzuality.github.com/cartodb-gmapsv3">CartoDB Google Maps library</a></li>
              <li><a href="/examples/">CartoDB Leaflet examples</a></li>
            </ul>
          </div>
        </div>
      </section>

      <section class="grey carto shadow margin40">
        <div class="content less_padding">
          <div class="left">
            <h2 class="compact dark">Further info? Take a look a the docs</h2>
            <p class="light">Visit our support area and get some help from the community.</p>
          </div>
          <div class="right">
            <a class="button blue right margin5" href="http://developers.cartodb.com/documentation/using-cartodb.html">Go to documentation</a>
          </div>
        </div>
      </section>

      <div class="background white border margin40">
        <section>
          <div class="content less_padding">
            <div class="left">
              <h3 class="lighter margin10">CartoDB is also used by</h3>
            </div>
            <div class="right">
              <ul class="logos">
                <li><a class="unep-wcmc" target="_blank" href="http://www.unep-wcmc.org/"><img alt="UNEP-WCMC" title="UNEP-WCMC" src="http://developers.cartodb.com/images/logos/unep-wcmc.png" /></a></li>
                <li><a class="nasa" target="nasa" href="http://www.nasa.gov"><img alt="NASA" title="NASA" src="http://developers.cartodb.com/images/logos/nasa.png" /></a></li>
                <li><a class="diversity" target="_blank" href="http://www.cbd.int/"><img alt="Convention on Biological Diversity" title="Convention on Biological Diversity" src="http://developers.cartodb.com/images/logos/diversity.png" /></a></li>
                <li><a class="wsj" target="_blank" href="http://europe.wsj.com/home-page"><img alt="Wall Street Journal" title="Wall Street Journal" src="http://developers.cartodb.com/images/logos/wsj.png" /></a></li>
                <li><a class="wri" target="_blank" href="http://www.wri.org/"><img alt="WORLD RESOURCES INSTITUTE" title="WORLD RESOURCES INSTITUTE" src="http://developers.cartodb.com/images/logos/wri.png" /></a></li>
              </ul>
            </div>
          </div>
        </section>
      </div>


      <div class="background white border">
        <section>
          <div class="content no_padding">
            <ul class="hz">
              <li>
                <h3>Common questions</h3>
              </li>
              <li>
                <h3>Do you have any educational plans?</h3>
                <p class="light margin15">Yes we have. <a href="mailto:wadus@cartodb.com">Contact us</a> for getting more information. We are quite friends of academics so, you will get a lot of benefits.</p>
              </li>
              <li>
                <h3>Need something extra? Let us now.</h3>
                <p class="light margin15">Need us to help you with your visualization or application? Does your organization have unique requirements that donâ€™t quite fit our plans? <a href="mailto:support@cartodb.com">Contact us</a>.</p>
              </li>
            </ul>
          </div>
        </section>
      </div>


      <footer>
        <div class="wrap">
          <span class="cartodb">CartoDB</span>
          <p class="lighter small left">CartoDB is a product of <a class="vizzuality" href="http://vizzuality.com">Vizzuality</a>
          </p>
          <nav class="right">
            <a href="http://cartodb.com/tour">Feature tour</a>
            <a href="http://cartodb.com/tutorial/step/1">Getting started</a>
            <a href="http://cartodb.com/maps">Maps</a>
            <a href="http://developers.cartodb.com/">Developers</a>
            <a href="http://blog.cartodb.com">Blog</a>
            <a href="http://cartodb.com/pricing">Pricing</a>
            <a href="mailto:support@cartodb.com">Contact</a>
          </nav>
        </div>
      </footer>
    </div>
  </body>
</html>